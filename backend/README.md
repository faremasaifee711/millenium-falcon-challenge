TODO:
- implement logic for waiting, and optimizations on waiting
    - use memoization to store best probablities for each waiting state.